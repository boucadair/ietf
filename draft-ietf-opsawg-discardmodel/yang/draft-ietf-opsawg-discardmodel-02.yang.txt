module ietf-packet-discard-reporting {
  yang-version 1.1;
  namespace
    "urn:ietf:params:xml:ns:yang:ietf-packet-discard-reporting";
  prefix plr;

  import ietf-yang-structure-ext {
    prefix sx;
    reference
      "RFC 8791: YANG Data Structure Extensions";
  }

  organization
    "IETF OPSAWG (Operations and Management Area Working Group)";
  contact
    "WG Web:   https://datatracker.ietf.org/wg/opsawg/
     WG List:  mailto:opsawg@ietf.org

     Author:   John Evans
               <mailto:jevanamz@amazon.co.uk>

     Author:   Oleksandr Pylypenko
               <mailto:opyl@amazon.com>

     Author:   Jeffrey Haas
               <mailto:jhaas@juniper.net>

     Author:   Aviran Kadosh
               <mailto:akadosh@cisco.com>

     Author:   Mohamed Boucadair
                  <mailto:mohamed.boucadair@orange.com>";

  description
    "This module defines an information model for packet discard reporting.";

  revision 2024-06-04 {
    description
      "Initial revision.";
    reference
      "draft-ietf-opsawg-discardmodel: An Information Model for Packet Discard Reporting";
  }

  typedef uint48-or-64 {
    description 
      "Union type representing either a 48-bit or 64-bit unsigned integer. 48-bit counters are used for packet and discard counters that increase at a lower rate, while 64-bit counters are used for traffic byte counters that may increase more rapidly."; 
    type union {
      type uint48; type uint64;
    }
  }

  typedef uint48 {
    type uint64 {
      range "0..281474976710655";
    }
  }


  /*
   * Groupings
   */

  grouping ip {
    description
      "IP traffic counters";
    leaf packets {
      type uint64;
      description
        "Number of IPv4 packets";
    }
    leaf bytes {
      type uint64;
      description
        "Number of IPv4 bytes";
    }
    container unicast {
      description
        "IPv4 unicast ingress traffic counters";
      leaf packets {
        type uint64;
        description
          "Number of IPv4 unicast packets";
      }
      leaf bytes {
        type uint64;
        description
          "Number of IPv4 unicast bytes";
      }
    }
    container multicast {
      description
        "IPv4 multicast ingress traffic counters";
      leaf packets {
        type uint64;
        description
          "Number of IPv4 multicast packets";
      }
      leaf bytes {
        type uint64;
        description
          "Number of IPv4 multicast bytes";
      }
    }
  }

  grouping interface {
    description
      "Interface-level packet loss counters";
    container ingress {
      description
        "Ingress counters";
      container traffic {
        description
          "Ingress traffic counters";
        container l2 {
          description
            "Layer 2 ingress traffic counters";
          leaf frames {
            type uint64;
            description
              "Number of L2 frames";
          }
          leaf bytes {
            type uint64;
            description
              "Number of L2 bytes";
          }
        }
        container l3 {
          description
            "Layer 3 ingress traffic counters";
          container v4 {
            description
              "IPv4 ingress traffic counters";
            uses ip;
          }
          container v6 {
            description
              "IPv6 ingress traffic counters";
            uses ip;
          }
        }
        container qos {
          description
            "Quality of Service (QoS) ingress traffic counters";
          list class {
            key "id";
            min-elements 1;
            description
              "QoS class ingress traffic counters";
            leaf id {
              type string;
              description
                "QoS class identifier";
            }
            leaf packets {
              type uint64;
              description
                "Number of packets in the QoS class";
            }
            leaf bytes {
              type uint64;
              description
                "Number of bytes in the QoS class";
            }
          }
        }
      }
      container discards {
        description
          "Ingress packet discard counters";
        container l2 {
          description
            "Layer 2 ingress packet discard counters";
          leaf frames {
            type uint64;
            description
              "Number of discarded L2 frames";
          }
          leaf bytes {
            type uint64;
            description
              "Number of discarded L2 bytes";
          }
        }
        container l3 {
          description
            "Layer 3 ingress packet discard counters";
          container v4 {
            description
              "IPv4 ingress packet discard counters";
            uses ip;
          }
          container v6 {
            description
              "IPv6 ingress packet discard counters";
            uses ip;
          }
        }
        container errors {
          description
            "Ingress packet error counters";
          container l2 {
            description
              "Layer 2 ingress packet error counters";
            container rx {
              description
                "Layer 2 ingress packet receive error counters";
              leaf frames {
                type uint48;
                description
                  "Number of errored L2 frames";
              }
              leaf crc-error {
                type uint48;
                description
                  "Number of frames received with CRC error";
              }
              leaf invalid-mac {
                type uint48;
                description
                  "Number of frames received with invalid MAC address";
              }
              leaf invalid-vlan {
                type uint48;
                description
                  "Number of frames received with invalid VLAN tag";
              }
              leaf invalid-frame {
                type uint48;
                description
                  "Number of invalid frames received";
              }
            }
          }
          container l3 {
            description
              "Layer 3 ingress packet error counters";
            container rx {
              description
                "Layer 3 ingress packet receive error counters";
              leaf packets {
                type uint48;
                description
                  "Number of errored L3 packets";
              }
              leaf checksum-error {
                type uint48;
                description
                  "Number of packets received with checksum error";
              }
              leaf mtu-exceeded {
                type uint48;
                description
                  "Number of packets received exceeding MTU";
              }
              leaf invalid-packet {
                type uint48;
                description
                  "Number of invalid packets received";
              }
              leaf ttl-expired {
                type uint48;
                description
                  "Number of packets received with expired TTL";
              }
            }
            leaf no-route {
              type uint48;
              description
                "Number of packets with no route";
            }
            leaf invalid-sid {
              type uint48;
              description
                "Number of packets with invalid SID";
            }
            leaf invalid-label {
              type uint48;
              description
                "Number of packets with invalid label";
            }
          }
          container hardware {
            description
              "Hardware error counters";
            leaf packets {
              type uint48;
              description
                "Number of local errored packets";
            }
            leaf parity-error {
              type uint48;
              description
                "Number of packets with parity error";
            }
          }
        }
        container policy {
          description
            "Policy-related ingress packet discard counters";
          container l2 {
            description
              "Layer 2 policy ingress packet discard counters";
            leaf frames {
              type uint48;
              description
                "Number of L2 frames discarded due to policy";
            }
            leaf acl {
              type uint48;
              description
                "Number of frames discarded due to L2 ACL";
            }
          }
          container l3 {
            description
              "Layer 3 policy ingress packet discard counters";
            leaf packets {
              type uint48;
              description
                "Number of L3 packets discarded due to policy";
            }
            leaf acl {
              type uint48;
              description
                "Number of packets discarded due to L3 ACL";
            }
            container policer {
              description
                "Policer ingress packet discard counters";
              leaf packets {
                type uint48;
                description
                  "Number of packets discarded by the policer";
              }
              leaf bytes {
                type uint48;
                description
                  "Number of bytes discarded by the policer";
              }
            }
            leaf null-route {
              type uint48;
              description
                "Number of packets discarded due to null route";
            }
            leaf rpf {
              type uint48;
              description
                "Number of packets discarded due to RPF check failure";
            }
            leaf ddos {
              type uint48;
              description
                "Number of packets discarded due to DDoS protection";
            }
          }
        }
        container no-buffer {
          description
            "Ingress packet discard counters due to buffer unavailability";
          list class {
            key "id";
            min-elements 1;
            description
              "Per-QoS class ingress packet discard counters due to buffer unavailability";
            leaf id {
              type string;
              description
                "QoS class identifier";
            }
            leaf packets {
              type uint64;
              description
                "Number of packets discarded due to buffer unavailability";
            }
            leaf bytes {
              type uint64;
              description
                "Number of bytes discarded due to buffer unavailability";
            }
          }
        }
      }
    }
    container egress {
      description
        "Egress counters";
      container traffic {
        description
          "Egress traffic counters";
        container l2 {
          description
            "Layer 2 egress traffic counters";
          leaf frames {
            type uint64;
            description
              "Number of L2 frames";
          }
          leaf bytes {
            type uint64;
            description
              "Number of L2 bytes";
          }
        }
        container l3 {
          description
            "Layer 3 egress traffic counters";
          container v4 {
            description
              "IPv4 egress traffic counters";
            uses ip;
          }
          container v6 {
            description
              "IPv6 egress traffic counters";
            uses ip;
          }
        }
        container qos {
          description
            "Quality of Service (QoS) egress traffic counters";
          list class {
            key "id";
            min-elements 1;
            description
              "QoS class egress traffic counters";
            leaf id {
              type string;
              description
                "QoS class identifier";
            }
            leaf packets {
              type uint64;
              description
                "Number of packets in the QoS class";
            }
            leaf bytes {
              type uint64;
              description
                "Number of bytes in the QoS class";
            }
          }
        }
      }
      container discards {
        description
          "Egress packet discard counters";
        container l2 {
          description
            "Layer 2 egress packet discard counters";
          leaf frames {
            type uint64;
            description
              "Number of discarded L2 frames";
          }
          leaf bytes {
            type uint64;
            description
              "Number of discarded L2 bytes";
          }
        }
        container l3 {
          description
            "Layer 3 egress packet discard counters";
          container v4 {
            description
              "IPv4 egress packet discard counters";
            uses ip;
          }
          container v6 {
            description
              "IPv6 egress packet discard counters";
            uses ip;
          }
        }
        container errors {
          description
            "Egress packet error counters";
          container l2 {
            description
              "Layer 2 egress packet error counters";
            container tx {
              description
                "Layer 2 egress packet transmit error counters";
              leaf frames {
                type uint48;
                description
                  "Number of errored L2 frames during transmission";
              }
            }
          }
          container l3 {
            description
              "Layer 3 egress packet error counters";
            container tx {
              description
                "Layer 3 egress packet transmit error counters";
              leaf packets {
                type uint48;
                description
                  "Number of errored L3 packets during transmission";
              }
            }
          }
        }
        container policy {
          description
            "Policy-related egress packet discard counters";
          container l3 {
            description
              "Layer 3 policy egress packet discard counters";
            leaf acl {
              type uint48;
              description
                "Number of packets discarded due to L3 egress ACL";
            }
            container policer {
              description
                "Policer egress packet discard counters";
              leaf packets {
                type uint48;
                description
                  "Number of packets discarded by the egress policer";
              }
              leaf bytes {
                type uint48;
                description
                  "Number of bytes discarded by the egress policer";
              }
            }
          }
        }
        container no-buffer {
          description
            "Egress packet discard counters due to buffer unavailability";
          list class {
            key "id";
            min-elements 1;
            description
              "Per-QoS class egress packet discard counters due to buffer unavailability";
            leaf id {
              type string;
              description
                "QoS class identifier";
            }
            leaf packets {
              type uint64;
              description
                "Number of packets discarded due to buffer unavailability";
            }
            leaf bytes {
              type uint64;
              description
                "Number of bytes discarded due to buffer unavailability";
            }
          }
        }
      }
    }
    container control-plane {
      description
        "Control plane packet loss counters";
      container ingress {
        description
          "Control plane ingress packet loss counters";
        container traffic {
          description
            "Control plane ingress traffic counters";
          leaf packets {
            type uint48;
            description
              "Number of control plane packets";
          }
          leaf bytes {
            type uint48;
            description
              "Number of control plane bytes";
          }
        }
        container discards {
          description
            "Control plane ingress packet discard counters";
          leaf packets {
            type uint48;
            description
              "Number of discarded control plane packets";
          }
          leaf bytes {
            type uint48;
            description
              "Number of discarded control plane bytes";
          }
          container policy {
            description
              "Control plane policy discard counters";
            leaf packets {
              type uint48;
              description
                "Number of control plane packets discarded due to policy";
            }          

          }
        }
      }
    }
  }
  
  
  /*
   * Main Structure
   */
  container packet-discard-reporting {
    description
      "Container for packet discard reporting data.";

    list interface {
      key "name";
      description
        "List of interfaces for which packet discard reporting data is provided.";

      leaf name {
        type string;
        description
          "Name of the interface.";
      }

      uses interface;
    }
  }
}